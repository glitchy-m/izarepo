<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Nearest Class</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://raw.githubusercontent.com/glitchy-m/izarepo/refs/heads/main/icon.png">
    <script>
async function findNearestClass() {
    // Show the loader initially
    document.getElementById("loader").style.display = "block";
    document.getElementById("classOutput").innerHTML = "";

    try {
        const jsonUrl = "https://raw.githubusercontent.com/glitchy-m/izarepo/refs/heads/main/schedule.json";
        const response = await fetch(jsonUrl);
        if (!response.ok) throw new Error('Network response was not ok');

        const jsonData = await response.json();
        const startDate = new Date(jsonData.startDate);
        const today = new Date();
        const daysBetween = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
        const currentDay = (daysBetween % 6) + 1;

        // Get the current time
        const currentTime = today.toTimeString().slice(0, 5); // Get current time in HH:MM format

        // Get the schedule for the current day
        const scheduleKey = `day${currentDay}`;
        const schedule = jsonData.schedule[scheduleKey];

        if (!schedule) {
            document.getElementById("classOutput").innerHTML = "No schedule available for today.";
            return;
        }

        // Initialize variables to track classes
        let previousClass = null;
        let nextClass = null;

        for (let i = 0; i < schedule.length; i++) {
            const classTime = schedule[i].time;

            // Find the next class
            if (classTime > currentTime && !nextClass) {
                nextClass = schedule[i];
            }

            // Find the closest previous class
            if (classTime < currentTime) {
                previousClass = schedule[i];
            }
        }

        // Check if the current time is between the previous and next classes
        let currentClass = null;
        if (previousClass && nextClass) {
            const previousTime = previousClass.time;
            const nextTime = nextClass.time;

            // If current time is between previous class and next class
            if (previousTime < currentTime && nextTime > currentTime) {
                currentClass = previousClass; // Current class is the one that just finished
            }
        }

        if (currentClass) {
            document.getElementById("classOutput").innerHTML = 
                `You are currently in class: <span class="current-class">${currentClass.class} at ${currentClass.time} at ${currentClass.building}</span>.`;
        } else if (nextClass) {
            document.getElementById("classOutput").innerHTML = 
                `The next class is ${nextClass.class} at ${nextClass.time} at ${nextClass.building}.`;
        } else {
            document.getElementById("classOutput").innerHTML = "No more classes.<br>Enjoy the rest of your day!";
        }
    } catch (error) {
        console.error("Error:", error);
        document.getElementById("classOutput").innerHTML = "Error fetching schedule: " + error.message;
    } finally {
        // Hide the loader after data is fetched or an error occurs
        document.getElementById("loader").style.display = "none";
    }
}

    </script>
</head>
<body onload="findNearestClass()">
    <header>
        <nav>
            <a href="index.html">Home</a>
            <a href="full-schedule.html">Schedule for Today</a>
            <a href="nearest-class.html" style="opacity:0.5;">Nearest Class</a>
            <a href="site.html">Current Day</a>
        </nav>
    </header>
    <br><a style="font-size: 250%; font-weight: 600;">Nearest Class</a>

    <!-- Loader will be visible while fetching -->
    <div id="loader" class="pulse-loader"></div>

    <!-- Output for the nearest class -->
    <p id="classOutput"></p>
    <p id="footer">Site made by <a href="https://glitchy-m.carrd.co">Alejandro</a> â€¢ <a href="https://isafixes.carrd.co">Issues?</a></p>
</body>
</html>
