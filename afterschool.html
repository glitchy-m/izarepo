<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Schedule Assistant V2 â€“ After School</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="https://raw.githubusercontent.com/glitchy-m/izarepo/refs/heads/main/icon.png">
</head>
<body>
  <div id="afterschoolContainer">
    <!-- Big white bubble -->
    <div id="bigBox" class="white-bubble">
      <h1>The day is <b>over!</b></h1>
      <div id="nextDayInfo" style="margin-top:10px; font-size:1.3rem;"></div>
      <div id="classesTitle" style="margin-top:10px; font-size:1.2rem;"></div>
    </div>
    
    <!-- Tomorrow's classes in pill form -->
    <div class="pills-container" id="tomorrowPills"></div>
    
    <!-- "Have a great (weekday)!" -->
    <div id="weekdayMessage"></div>
  </div>
  
  <footer>
    Schedule Assistant <b>V2.</b> Made by <i>Alejandro Moralez.</i>
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const scheduleUrl = "https://raw.githubusercontent.com/glitchy-m/izarepo/refs/heads/main/schedule.json";

    function getCurrentDay(jsonData) {
      const now = new Date();
      const startDate = new Date(jsonData.startDate);

      // Count holiday dates between startDate and now
      let holidayCount = 0;
      if (jsonData["holiday-dates"]) {
        jsonData["holiday-dates"].forEach(dateStr => {
          let holiday = new Date(dateStr);
          if (holiday >= startDate && holiday < now) {
            holidayCount++;
          }
        });
      }

      let dayOffset = now.getHours() >= 18 ? -1 : 0;
      let daysBetween = Math.floor((now - startDate) / (1000 * 60 * 60 * 24)) + dayOffset;
      let effectiveDays = daysBetween - holidayCount;
      let currentDay = ((effectiveDays % 6) + 6) % 6 + 1; // cycles 1..6
      return currentDay;
    }

    fetch(scheduleUrl)
      .then(r => r.json())
      .then(jsonData => {
        const now = new Date();
        const currentDay = getCurrentDay(jsonData);
        const nextDay = (currentDay === 6) ? 1 : (currentDay + 1);

        document.getElementById("nextDayInfo").textContent = `Tomorrow is day ${nextDay}.`;
        document.getElementById("classesTitle").textContent = `Tomorrow's classes are:`;

        // Abbreviations or short names
        const abbreviations = {
          "Chromebook Pick-up and Attendance": "CP&A",
          "Structured Individualized Learning": "SIL",
          "Independent Study & Research": "IS&R",
          "Science & Tech": "Science",
          "Digital Art": "Digital Arts",
          "Fine Art": "Fine Art",
          "Belizean Studies": "Belizean Studies",
          "Language Arts": "Language Arts",
          "Quantitative Reasoning": "QR",
          "Sustainable Development Projects": "SDP",
          "Super Teams & Intramurals": "Super Teams",
          "Classroom Cleanup & Duties": "Cleanup",
          "Advisory / Life Skills": "Advisory",
          "Maker": "Maker",
          "Seminar": "Seminar",
          "PE": "PE",
          "Assembly": "Assembly",
          "Lunch": "Lunch"
        };

        // Grab tomorrow's schedule
        const tomorrowScheduleAll = jsonData.schedule["day" + nextDay];
        // Filter out any breaks (case-insensitive "break" in the class name)
        const tomorrowSchedule = tomorrowScheduleAll.filter(
          c => !c.class.toLowerCase().includes("break")
        );

        let pillsHTML = "";
        tomorrowSchedule.forEach(classInfo => {
          let label = abbreviations[classInfo.class] || classInfo.class;
          // If it's PE, add special gradient
          if (classInfo.class === "PE") {
            pillsHTML += `<div class="pill pe-pill">${label}</div>`;
          } else {
            pillsHTML += `<div class="pill">${label}</div>`;
          }
        });
        document.getElementById("tomorrowPills").innerHTML = pillsHTML;

        // "Have a great (weekday)!"
        let tomorrowDate = new Date(now);
        tomorrowDate.setDate(now.getDate() + 1);
        const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
        document.getElementById("weekdayMessage").textContent =
          `Have a great ${weekdays[tomorrowDate.getDay()]}!`;
      })
      .catch(err => {
        console.error("Error:", err);
        document.getElementById("bigBox").textContent = "Error fetching schedule.\nPlease contact me to fix this, it's a serious error !!";
      });
  });
  </script>
</body>
</html>
